<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>レシピ作成フォーム</title>
  <script>
    function fetchRecipe(id) {
      if (!id) return;

      // 元レシピ情報（材料・ジャンルなど）
      fetch(`/api/recipe/${id}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('name').value = data.name || '';
          document.getElementById('genre').value = data.genre || '';
          document.getElementById('materials').value = (data.materials || []).join('\n');
          document.getElementById('image').value = data.image || '';
        });

      // 作り方を含む生成済みHTMLからも読み込む
      fetch(`/api/generated/${id}`)
        .then(res => res.json())
        .then(data => {
          if (data.steps) {
            document.getElementById('steps').value = data.steps;
          }
        });
    }
  </script>
</head>
<body>
  <h1>レシピ作成フォーム</h1>
  <form method="POST" action="/generate">
    <label>元レシピID（選択式）:</label>
    <select name="id" onchange="fetchRecipe(this.value)">
      <option value="">選択してください</option>
      {% for id in ids %}
      <option value="{{ '%03d'|format(id|int) }}">{{ id }}</option>
      {% endfor %}
    </select><br>

    <label>料理名:</label><input name="name" id="name"><br>
    <label>ジャンル:</label><input name="genre" id="genre"><br>
    <label>材料（改行区切り）:</label><br>
    <textarea name="materials" id="materials" rows="5" cols="40"></textarea><br>
    <label>作り方（改行区切り）:</label><br>
    <textarea name="steps" id="steps" rows="5" cols="40"></textarea><br>

    <input type="hidden" name="image" id="image">

    <label>クックパッドレシピID（任意）:</label>
    <input name="cookpad_id" id="cookpad_id"><br>

    <button type="submit">HTML生成</button>
  </form>
</body>
</html>
